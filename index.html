<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8">
  <title>OFI2GIF</title>
  <link rel="icon" type="image/x-icon" href="./images/favicon.ico">
  <link rel="stylesheet" href="stylesheet.css">
</head>

<body>
  <div>
    <button id='canvasButton'>Add Slide</button>
    <button id='createAnimationButton'>Create Animation</button>
    <button onClick="window.location.reload();">Refresh Page</button>
    <div class="wrapper">

      <table contenteditable="true">
        <tr>
          <td>8</td>
          <td>Elsa-Brändström-Str.</td>
          <td>sofort</td>
        </tr>
        <tr>
          <td>351</td>
          <td>Starpark</td>
          <td>2 min</td>
        </tr>
        <tr>
          <td>43</td>
          <td>Heide</td>
          <td>12:32</td>
        </tr>
        <tr>
          <td> i </td>
          <td colspan="2">
            <marquee>
              1234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890
            </marquee>
          </td>
        </tr>
      </table>


    </div>

    <div>
      <img id="gifAnimation">
    </div>
  </div>
  <div>
    <canvas id="bitmap"></canvas>
  </div>


  <script src="./third-party/html2canvas/html2canvas.js"></script>
  <script src="./third-party/jsgif/b64.js"></script>
  <script src="./third-party/jsgif/LZWEncoder.js"></script>
  <script src="./third-party/jsgif/NeuQuant.js"></script>
  <script src="./third-party/jsgif/GIFEncoder.js"></script>
  <script>

    let canvasHeight;
    let canvasWidth;

    let btn = document.getElementById('canvasButton');
    btn.addEventListener('click', addCanvas);

    let btn2 = document.getElementById('createAnimationButton');
    btn2.addEventListener('click', mergeCanvases);
    btn2.hidden = true;



    function addCanvas() {

      element = document.getElementsByClassName("wrapper")[0];
      const lineBreak = document.createElement('br');

      html2canvas(element).then(function (canvas) {
        canvasHeight = canvas.height;
        canvasWidth = canvas.width;
        btn2.hidden = false;
        document.body.appendChild(lineBreak);
        document.body.appendChild(canvas);
      });
    }

    function mergeCanvases() {
      var encoder = new GIFEncoder();
      encoder.setRepeat(0);
      encoder.setDelay(1500);
      canvases = document.getElementsByTagName("canvas");

      encoder.setSize(canvasWidth, canvasHeight);
      console.log(encoder.start());

      for (let canvas of canvases) {
        if (canvas.id != "bitmap") {
          console.log(canvas.height + " " + canvas.width);
          let context = canvas.getContext('2d');
          encoder.addFrame(context);
        }
      }

      encoder.finish();
      document.getElementById('gifAnimation').src = 'data:image/gif;base64,' + encode64(encoder.stream().getData())
    }
  </script>

</body>

</html>